name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Generate catalog
        run: python scripts/generate_catalog.py

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Build with Jekyll
        run: |
          bundle exec jekyll build --baseurl "/ML-Interview-Based-Blogs"
        env:
          JEKYLL_ENV: production

      - name: Copy content directories to _site
        run: |
          # Copy all content directories that were excluded from Jekyll
          for dir in "LLM" "Agents" "RAG" "Neural Network" "Computer Vision" "Traditional ML" "Statistics" "System Design" "Cuda and GPU" "Diffusion" "Reinforcement Learning(RL)" "Vision Language Models(VLMs)"; do
            if [ -d "$dir" ]; then
              cp -r "$dir" "_site/"
              echo "Copied $dir to _site/"
            fi
          done
          # Also copy catalog.json
          cp catalog.json _site/ 2>/dev/null || true

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

